<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ESP8266 Sensor Realtime</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body {
    font-family: Arial;
    background: #0b0b0b;
    color: #00ff99;
    text-align: center;
  }
  .card {
    border: 2px solid #00ff99;
    border-radius: 10px;
    width: 320px;
    margin: 20px auto;
    padding: 20px;
    display: none;
  }
  button {
    font-size: 18px;
    padding: 10px 25px;
    margin: 10px;
    cursor: pointer;
  }
</style>
</head>

<body>

<h1>ðŸŒ± ESP8266 Sensor Monitor</h1>

<button onclick="systemOn()">ðŸŸ¢ à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸š</button>
<button onclick="systemOff()">ðŸ”´ à¸›à¸´à¸”à¸£à¸°à¸šà¸š</button>

<div class="card" id="sensorBox">
  <h2>ðŸ“¡ Realtime Data</h2>
  <p>Soil : <span id="soil">--</span> %</p>
  <p>Temp : <span id="temp">--</span> Â°C</p>
  <p>Alarm : <span id="alarm">--</span></p>
</div>

<script>
  // ===== Firebase Config =====
  const firebaseConfig = {
    apiKey: "AIzaSyC1a-XkNqLQ-fR9K9G3rRq4H3k9SKw9EF0",
    databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com/"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const sensorBox = document.getElementById("sensorBox");
  let sensorRef = null;

  // ===== à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸š =====
  function systemOn() {
    db.ref("control/enable").set(true);
    sensorBox.style.display = "block";

    sensorRef = db.ref("sensor");
    sensorRef.on("value", snap => {
      const d = snap.val();
      if (!d) return;

      document.getElementById("soil").innerText = d.soil;
      document.getElementById("temp").innerText = d.temperature;
      document.getElementById("alarm").innerText =
        d.alarm ? "ðŸš¨ ON" : "âœ… OFF";
    });
  }

  // ===== à¸›à¸´à¸”à¸£à¸°à¸šà¸š =====
  function systemOff() {
    db.ref("control/enable").set(false);

    if (sensorRef) {
      sensorRef.off();
      sensorRef = null;
    }

    sensorBox.style.display = "none";
  }

  // ===== à¹€à¸Šà¹‡à¸„à¸ªà¸–à¸²à¸™à¸°à¸•à¸­à¸™à¹€à¸›à¸´à¸”à¹€à¸§à¹‡à¸š =====
  db.ref("control/enable").on("value", snap => {
    if (snap.val() === true) {
      systemOn();
    } else {
      systemOff();
    }
  });
</script>

</body>
</html>
